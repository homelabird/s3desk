# 즐겨찾기/북마크 방향성 (초안)

## 목적
- 재방문이 잦은 객체/경로를 1~2클릭으로 재사용하게 해 작업 반복 시간을 줄인다.
- 복잡한 경로 탐색이나 검색을 건너뛰고 바로 작업 컨텍스트로 이동한다.

## 범위
- 초기(Phase 1): 객체/프리픽스/버킷 즐겨찾기 + 즐겨찾기 필터/우선정렬 + 즐겨찾기 전용 리스트/네비
- 확장(Phase 1.5): 저장된 검색/필터(북마크) + 빠른 이동(저장/삭제/이름 변경)
- 제외: 공유/팀 범위 즐겨찾기, 컬렉션/태그, 자동 추천, 교차 계정 동기화
- 권한: 즐겨찾기는 접근 권한을 대체하지 않음(권한 없는 항목은 접근 시 실패)

## 용어 정의
- 즐겨찾기(Favorite): 객체/프리픽스/버킷에 붙는 속성(별 토글), 목록에서 필터/정렬 가능
- 북마크(Bookmark): 화면 상태(경로, 필터, 정렬, 검색어)를 저장한 바로가기
- 프리픽스(Prefix): 객체 키의 공통 접두어를 “가상 폴더”로 표현한 경로
- 객체(Object): 버킷 내 단일 키(파일)
- UI 용어는 “즐겨찾기”로 통일하고, “북마크”는 저장된 검색에만 사용

## 핵심 시나리오
- 자주 여는 버킷/경로로 즉시 이동
- 중요한 파일을 빠르게 찾아 작업(다운로드/링크/삭제 등)
- 반복 작업을 위한 “필터+정렬” 조합 저장

## UX 방향
- 위치: 리스트 행(첫 컬럼 별 토글), 상세 패널 헤더, 상단 툴바 “즐겨찾기만” 필터, 좌측 네비 “즐겨찾기” 섹션
- 동작: 토글은 낙관적 업데이트 + 실패 시 롤백/토스트, `aria-pressed`로 접근성 표시
- 탐색: 즐겨찾기 전용 뷰에서 바로 이동, 정렬은 기본 유지 + “즐겨찾기 먼저” 옵션
- 표시: 컴팩트 모드에서는 아이콘 중심, 와이드 모드에서는 아이콘+텍스트
- 힌트: 즐겨찾기 개수, 최근 접근/사용 시각을 보조 정보로 제공

## UX 위치 상세 (우선순위)
- 필수: 객체 리스트 행의 이름 영역 앞(별 토글), 상세 패널 헤더(별 토글)
- 권장: 리스트 상단 필터 영역의 “즐겨찾기만” 토글, 좌측 네비의 즐겨찾기 섹션
- 선택: 컨텍스트 메뉴의 “즐겨찾기 추가/해제”, 브레드크럼 옆 미니 토글

## 배치 원칙
- 체크박스/드래그/행 클릭과 충돌하지 않는 위치에 고정
- 모바일/컴팩트 모드에서는 아이콘 중심으로 유지

## 데이터/모델 방향
- 엔티티 타입: bucket | prefix | object | search
- 식별자: user_id + type + bucket + key_or_search_hash (복합 유니크)
- key 정규화: prefix는 항상 `/`로 끝나도록 저장, object는 원본 key 유지
- 최소 필드: id, user_id, type, bucket, key, title, created_at, updated_at
- 선택 필드: last_accessed_at, note, search_payload(JSON, 북마크 전용)
- 인덱스: (user_id, type), (user_id, bucket), (user_id, type, key)
- 스코프: 1차는 단일 사용자/인스턴스 범위(공유 없음)

## 동기화/성능
- 리스트는 즐겨찾기 여부만 가볍게 포함(추가 쿼리 최소화)
- 즐겨찾기 목록은 사용자 단위로 캐시(짧은 TTL)하고, 토글 시 캐시 무효화
- 즐겨찾기 변경은 즉시 반영, 백엔드 실패 시 재시도/복구
- 대용량 목록은 서버 필터 + 클라이언트 가상화 유지
- 토글 응답 SLA: p50 < 200ms, p95 < 800ms 목표
- 동시성: 동일 항목에 대한 중복 토글은 마지막 요청 승리

## 비기능/정책
- 대상 객체 삭제 시 즐겨찾기는 자동 해제 또는 “깨진 항목”으로 표시
- 즐겨찾기 최대 개수 제한 여부는 운영 데이터로 결정
- 권한/가시성 변경 시: 접근 실패 발생 시 항목은 숨기고 알림 제공
- 이름 변경/이동 시: 객체 키 변경 이벤트에 맞춰 즐겨찾기 키 동기화

## 성공 지표
- 즐겨찾기 사용 전/후 평균 탐색 시간 감소
- 즐겨찾기 재방문율(일/주)
- 즐겨찾기 토글 실패율 및 지연 시간
- 즐겨찾기 보유 항목 수 분포(상위 10% 사용자 기준)
- 북마크(저장된 검색) 재사용률

## 향후 확장 아이디어
- 즐겨찾기 그룹/컬렉션
- 공유 즐겨찾기(팀/프로젝트 단위)
- 자동 즐겨찾기(빈도 기반 추천)

## 오픈 이슈
- 북마크(화면 상태) 범위에 정렬/필터를 어디까지 포함할지
- 즐겨찾기 전용 화면의 위치(탭 vs 좌측 네비)
- 삭제된 항목 처리 UX(자동 제거 vs 복구 힌트)

## 실행 항목 (오픈 이슈 분해)
- 북마크 저장 범위 확정: 포함 필터/정렬, 저장 제한 개수, 기본 정렬
- 전용 화면 위치 확정: 탭 vs 좌측 네비, 기본 진입 경로
- 삭제/권한 변경 처리 결정: 자동 제거 vs 숨김, UI 메시지 규칙
- 데이터 모델 확정: prefix 정규화 규칙, 유니크 키 구성, search_payload 스키마
- API 계약 확정: 목록/추가/삭제/수정, 에러 코드, 페이징 규칙
- 캐시/동기화 정책 확정: TTL, 무효화 조건, 재시도 백오프
- 테스트 계획: 모델 단위, API CRUD, UI 토글/필터/정렬 회귀

## API/스키마 초안 (Draft)
- 엔드포인트
  - GET `/api/favorites?type=&bucket=&q=&limit=&cursor=`
  - POST `/api/favorites`
  - PATCH `/api/favorites/{id}`
  - DELETE `/api/favorites/{id}`
  - GET `/api/bookmarks?limit=&cursor=`
  - POST `/api/bookmarks`
  - DELETE `/api/bookmarks/{id}`
- 요청/응답 예시
  - POST `/api/favorites`
    - body: `{"type":"object","bucket":"media","key":"path/file.mp4","title":"file.mp4","note":""}`
  - POST `/api/bookmarks`
    - body: `{"title":"최근 수정 큰 파일","search_payload":{"prefix":"logs/","sort":"modified_desc","min_size":1048576}}`
- 오류 규칙
  - 409: 중복 즐겨찾기
  - 404: 항목 없음
  - 403: 접근 권한 없음
